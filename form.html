<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Pendaftaran Interaktif</title>
    <!-- Memuat Tailwind CSS untuk styling modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        :root {
            font-family: 'Inter', sans-serif;
        }

        /* Kustomisasi styling progress bar */
        .progress-bar-container {
            height: 8px;
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 9999px; /* full rounded */
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #3b82f6; /* blue-500 */
            text-align: center;
            line-height: 8px;
            color: white;
            transition: width 0.3s ease;
            font-size: 0.5rem;
        }

        /* Spinner untuk loading */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .required-star {
            color: #ef4444; /* red-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

<div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden">
    
    <header class="bg-blue-600 p-6 text-white">
        <h1 class="text-3xl font-extrabold text-center">Formulir Pendaftaran Peserta</h1>
        <p class="text-center mt-1 text-blue-200">Isi data diri dengan lengkap dan unggah foto terbaik Anda.</p>
    </header>

    <div class="p-6 sm:p-8">
        <!-- Status Message Area -->
        <div id="statusMessage" role="alert" style="display: none;" 
             class="p-4 mb-4 rounded-lg font-medium transition-all duration-300">
        </div>

        <form id="biodataForm" class="space-y-6">

            <!-- Fieldset 1: Informasi Kontak -->
            <fieldset class="border border-gray-200 p-5 rounded-lg">
                <legend class="text-lg font-semibold px-2 text-gray-700">Informasi Kontak</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div class="form-group">
                        <label for="namaLengkap" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap <span class="required-star">*</span></label>
                        <input type="text" id="namaLengkap" name="namaLengkap" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    </div>
                    
                    <div class="form-group">
                        <label for="noTelepon" class="block text-sm font-medium text-gray-700 mb-1">No. Telepon <span class="required-star">*</span></label>
                        <input type="tel" id="noTelepon" name="noTelepon" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                               oninput="validatePhone(this)">
                        <p id="phoneError" class="mt-1 text-xs text-red-500" style="display: none;">Format nomor telepon tidak valid (Contoh: 0812xxxx).</p>
                    </div>

                    <div class="form-group md:col-span-2">
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email <span class="required-star">*</span></label>
                        <input type="email" id="email" name="email" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"
                               oninput="validateEmail(this)">
                        <p id="emailError" class="mt-1 text-xs text-red-500" style="display: none;">Format email tidak valid (Contoh: user@domain.com).</p>
                    </div>
                </div>
            </fieldset>

            <!-- Fieldset 2: Detail Pribadi -->
            <fieldset class="border border-gray-200 p-5 rounded-lg">
                <legend class="text-lg font-semibold px-2 text-gray-700">Detail Pribadi</legend>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div class="form-group">
                        <label for="tempatLahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat Lahir <span class="required-star">*</span></label>
                        <input type="text" id="tempatLahir" name="tempatLahir" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    </div>

                    <div class="form-group">
                        <label for="tanggalLahir" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Lahir <span class="required-star">*</span></label>
                        <input type="date" id="tanggalLahir" name="tanggalLahir" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                    </div>
                    
                    <div class="form-group">
                        <label for="gender" class="block text-sm font-medium text-gray-700 mb-1">Gender <span class="required-star">*</span></label>
                        <select id="gender" name="gender" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 appearance-none bg-white">
                            <option value="">Pilih Gender</option>
                            <option value="Pria">Pria</option>
                            <option value="Wanita">Wanita</option>
                        </select>
                    </div>

                    <div class="form-group md:col-span-3">
                        <label for="alamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat Lengkap <span class="required-star">*</span></label>
                        <textarea id="alamat" name="alamat" rows="3" required 
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"></textarea>
                    </div>

                    <div class="form-group md:col-span-3">
                        <label for="agama" class="block text-sm font-medium text-gray-700 mb-1">Agama <span class="required-star">*</span></label>
                        <select id="agama" name="agama" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 appearance-none bg-white">
                            <option value="">Pilih Agama</option>
                            <option value="Islam">Islam</option>
                            <option value="Kristen">Kristen</option>
                            <option value="Katolik">Katolik</option>
                            <option value="Hindu">Hindu</option>
                            <option value="Buddha">Buddha</option>
                            <option value="Konghucu">Konghucu</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                </div>
            </fieldset>
            
            <!-- Fieldset 3: Foto & Biografi -->
            <fieldset class="border border-gray-200 p-5 rounded-lg">
                <legend class="text-lg font-semibold px-2 text-gray-700">Foto & Biografi</legend>

                <div class="form-group mb-4">
                    <label for="foto" class="block text-sm font-medium text-gray-700 mb-1">Unggah Foto Profil (Max 1MB, JPG/PNG) <span class="required-star">*</span>:</label>
                    <input type="file" id="foto" name="foto" accept="image/jpeg, image/png" required 
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                           onchange="previewImage(event)">
                    <p id="fileError" class="mt-2 text-xs text-red-500" style="display: none;">Ukuran file melebihi batas 1MB atau format tidak didukung.</p>
                </div>

                <!-- Pratinjau Foto -->
                <div class="mt-4 mb-6 flex justify-center p-4 border border-dashed border-gray-300 rounded-lg">
                    <div id="previewPlaceholder" class="text-gray-400 text-center p-4">
                        Pratinjau Foto (Max 1MB)
                    </div>
                    <img id="imagePreview" src="#" alt="Pratinjau Foto" 
                         class="max-w-full max-h-48 rounded-lg shadow-md" style="display: none;">
                </div>

                <div class="form-group">
                    <label for="biografi" class="block text-sm font-medium text-gray-700 mb-1">Biografi Singkat (Maks. 200 Karakter)</label>
                    <textarea id="biografi" name="biografi" rows="3" maxlength="200" 
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150"></textarea>
                    <p class="text-xs text-gray-500 mt-1" id="charCount">0/200 karakter</p>
                </div>
            </fieldset>

            <!-- Checkbox Persetujuan -->
            <div class="form-group flex items-start">
                <input type="checkbox" id="setujuData" name="setujuData" value="Ya" required 
                       class="mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                <label for="setujuData" class="ml-2 text-sm text-gray-900">
                    Saya menyatakan data yang diisi adalah benar dan setuju untuk menyimpan data ini. <span class="required-star">*</span>
                </label>
            </div>

            <!-- Tombol Submit dan Loading -->
            <button type="submit" id="submitButton" 
                    class="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 disabled:bg-blue-400">
                Daftar
            </button>
            
            <div class="loading-message mt-4 text-center" id="loadingMessage" style="display: none;">
                <div class="flex items-center justify-center space-x-2">
                    <div class="spinner"></div>
                    <span class="text-blue-600 font-semibold">Mengirim data dan mengunggah foto...</span>
                </div>
            </div>

            <div class="progress-bar-container mt-4" id="progressBarContainer" style="display: none;">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>

        </form>
    </div>
</div>

<script>
    /* --- JAVASCRIPT LOGIC --- */
    
    // URL DEPLOYMENT BARU ANDA
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw_rBF57HdUx6psT4NaDQo5mf0tApdwrpMTaeYyDA3gKLFbVJ6gaHXkz9UPZeOA1cm8Gg/exec'; 
    const maxFileSize = 1 * 1024 * 1024; // 1 MB

    // --- Helper Functions ---

    function validateEmail(input) {
        const errorElement = document.getElementById('emailError');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(input.value) && input.value.length > 0) {
            errorElement.style.display = 'block';
            input.classList.add('border-red-500');
        } else {
            errorElement.style.display = 'none';
            input.classList.remove('border-red-500');
        }
    }

    function validatePhone(input) {
        const errorElement = document.getElementById('phoneError');
        const phoneRegex = /^[0-9\s\+]+$/; 
        if (!phoneRegex.test(input.value) && input.value.length > 0) {
            errorElement.style.display = 'block';
            input.classList.add('border-red-500');
        } else {
            errorElement.style.display = 'none';
            input.classList.remove('border-red-500');
        }
    }

    function previewImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('imagePreview');
        const placeholder = document.getElementById('previewPlaceholder');
        const fileError = document.getElementById('fileError');
        
        fileError.style.display = 'none';

        if (file) {
            if (file.size > maxFileSize) {
                fileError.textContent = '❌ Ukuran file melebihi batas 1MB.';
                fileError.style.display = 'block';
                event.target.value = null; 
                preview.style.display = 'none';
                placeholder.style.display = 'block';
                return;
            }
            if (file.type !== 'image/jpeg' && file.type !== 'image/png') {
                fileError.textContent = '❌ Format file harus JPG atau PNG.';
                fileError.style.display = 'block';
                event.target.value = null; 
                preview.style.display = 'none';
                placeholder.style.display = 'block';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
            };
            reader.readAsDataURL(file);
        } else {
            preview.style.display = 'none';
            preview.src = '#';
            placeholder.style.display = 'block';
        }
    }

    document.getElementById('biografi').addEventListener('input', function() {
        const charCount = document.getElementById('charCount');
        charCount.textContent = `${this.value.length}/200 karakter`;
    });

    // --- Main Form Submission ---
    document.getElementById('biodataForm').addEventListener('submit', function(e) {
        e.preventDefault(); 
        
        const form = e.target;
        const submitButton = document.getElementById('submitButton');
        const loadingMessage = document.getElementById('loadingMessage');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');
        const statusMessage = document.getElementById('statusMessage');
        
        statusMessage.style.display = 'none';
        
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        if (document.getElementById('emailError').style.display === 'block' || 
            document.getElementById('phoneError').style.display === 'block') {
            statusMessage.className = 'p-4 mb-4 rounded-lg font-medium bg-yellow-100 text-yellow-800';
            statusMessage.textContent = '⚠️ Harap perbaiki kesalahan input (Email/Telepon) sebelum mendaftar.';
            statusMessage.style.display = 'block';
            return;
        }
        
        const fotoInput = document.getElementById('foto');
        const fotoFile = fotoInput.files[0];

        if (!fotoFile) {
             statusMessage.className = 'p-4 mb-4 rounded-lg font-medium bg-red-100 text-red-800';
             statusMessage.textContent = '❌ Unggahan foto gagal. Harap pilih file foto.';
             statusMessage.style.display = 'block';
             return;
        }
        
        const formData = new FormData(form); 

        // Tampilkan indikator loading
        submitButton.disabled = true;
        submitButton.innerHTML = `<div class="spinner border-t-white border-blue-200"></div>`;
        loadingMessage.style.display = 'block';
        progressBarContainer.style.display = 'block';
        
        // Simulasikan Progress Bar
        let progress = 0;
        const interval = setInterval(() => {
            if (progress < 90) { 
                progress += Math.floor(Math.random() * 5) + 1; 
                progress = Math.min(progress, 90);
                progressBar.style.width = progress + '%';
                progressBar.textContent = progress + '%';
            } else if (progress < 99) {
                 progress += 1;
                 progressBar.style.width = progress + '%';
                 progressBar.textContent = progress + '%';
            }
        }, 300);

        fetch(WEB_APP_URL, {
            method: 'POST',
            body: formData 
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            clearInterval(interval);
            progressBar.style.width = '100%';
            progressBar.textContent = '100%';

            if (data.result === 'success') {
                statusMessage.className = 'p-4 mb-4 rounded-lg font-medium bg-green-100 text-green-800';
                statusMessage.textContent = '✅ Pendaftaran Berhasil! Data Anda telah tersimpan.';
                form.reset(); 
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('previewPlaceholder').style.display = 'block';
                document.getElementById('charCount').textContent = '0/200 karakter';
            } else {
                statusMessage.className = 'p-4 mb-4 rounded-lg font-medium bg-red-100 text-red-800';
                statusMessage.textContent = `❌ Pendaftaran Gagal. Pesan: ${data.message || 'Terjadi kesalahan pada server skrip.'} (Periksa Izin Google Drive)`;
            }
        })
        .catch(error => {
            clearInterval(interval);
            statusMessage.className = 'p-4 mb-4 rounded-lg font-medium bg-red-100 text-red-800';
            statusMessage.textContent = `❌ Pendaftaran Gagal Total. Cek koneksi atau URL Apps Script. (${error.message})`;
        })
        .finally(() => {
            loadingMessage.style.display = 'none';
            progressBarContainer.style.display = 'none';
            submitButton.disabled = false;
            submitButton.innerHTML = `Daftar`;
            statusMessage.style.display = 'block';
        });
    });
</script>

</body>
</html>
